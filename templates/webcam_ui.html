<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Museo Scholar - Interactive Object Detection</title>
		<style>
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}

			body {
				font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
				background: #f5f5f5;
				min-height: 100vh;
				padding: 20px;
			}

			.container {
				max-width: 1400px;
				margin: 0 auto;
				background: white;
				border-radius: 4px;
				box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
				overflow: hidden;
			}

			header {
				background: #2c3e50;
				color: white;
				padding: 25px 30px;
				border-bottom: 3px solid #34495e;
			}

			h1 {
				font-size: 1.8em;
				margin-bottom: 5px;
				font-weight: 500;
			}

			.subtitle {
				font-size: 0.95em;
				opacity: 0.85;
			}

			.content {
				display: grid;
				grid-template-columns: 1fr 1fr;
				gap: 20px;
				padding: 30px;
			}

			.video-section {
				position: relative;
			}

			.video-container {
				position: relative;
				width: 100%;
				border: 1px solid #ddd;
				overflow: hidden;
				cursor: crosshair;
			}

			#video-feed {
				width: 100%;
				height: auto;
				display: block;
			}

			.click-indicator {
				position: absolute;
				width: 20px;
				height: 20px;
				border: 3px solid #ff4444;
				border-radius: 50%;
				transform: translate(-50%, -50%);
				pointer-events: none;
				animation: pulse 1s ease-out;
			}

			@keyframes pulse {
				0% {
					transform: translate(-50%, -50%) scale(0);
					opacity: 1;
				}
				100% {
					transform: translate(-50%, -50%) scale(2);
					opacity: 0;
				}
			}

			.info-section {
				background: #fafafa;
				border: 1px solid #e0e0e0;
				padding: 25px;
			}

			.info-header {
				font-size: 1.3em;
				color: #333;
				margin-bottom: 20px;
				font-weight: 500;
				border-bottom: 2px solid #ddd;
				padding-bottom: 10px;
			}

			.info-content {
				min-height: 300px;
			}

			.placeholder {
				text-align: center;
				color: #999;
				padding: 50px 20px;
				font-size: 1.1em;
			}

			.object-info {
				animation: fadeIn 0.5s ease-in;
			}

			@keyframes fadeIn {
				from {
					opacity: 0;
					transform: translateY(10px);
				}
				to {
					opacity: 1;
					transform: translateY(0);
				}
			}

			.info-card {
				background: white;
				padding: 15px;
				border: 1px solid #e0e0e0;
				margin-bottom: 12px;
			}

			.info-label {
				font-weight: 600;
				color: #555;
				margin-bottom: 8px;
				font-size: 0.85em;
				text-transform: uppercase;
				letter-spacing: 0.5px;
			}

			.info-value {
				color: #333;
				font-size: 1.1em;
				line-height: 1.6;
			}

			.confidence-bar {
				width: 100%;
				height: 6px;
				background: #e0e0e0;
				overflow: hidden;
				margin-top: 8px;
			}

			.confidence-fill {
				height: 100%;
				background: #2c3e50;
				transition: width 0.5s ease;
			}

			.loading {
				display: inline-block;
				width: 20px;
				height: 20px;
				border: 3px solid #f3f3f3;
				border-top: 3px solid #2c3e50;
				border-radius: 50%;
				animation: spin 1s linear infinite;
			}

			@keyframes spin {
				0% {
					transform: rotate(0deg);
				}
				100% {
					transform: rotate(360deg);
				}
			}

			.instructions {
				background: #f8f9fa;
				border: 1px solid #dee2e6;
				padding: 12px;
				margin-bottom: 15px;
				font-size: 0.9em;
				color: #555;
			}

			.instructions strong {
				color: #333;
			}

			@media (max-width: 1024px) {
				.content {
					grid-template-columns: 1fr;
				}
			}
		</style>
	</head>
	<body>
		<div class="container">
			<header>
				<h1>Museo Scholar</h1>
				<p class="subtitle">
					Interactive Museum Artifact Detection & Information System
				</p>
			</header>

			<div class="content">
				<div class="video-section">
					<div class="instructions">
						<strong>Instructions:</strong> Click on any detected object in the
						video to get detailed information.
					</div>
					<div class="video-container" id="video-container">
						<img
							src="{{ url_for('video_feed') }}"
							id="video-feed"
							alt="Video Feed" />
					</div>
				</div>

				<div class="info-section">
					<div class="info-header">Object Information</div>
					<div class="info-content" id="info-content">
						<div class="placeholder">
							<p>
								Click on a detected object in the video to see detailed
								information
							</p>
						</div>
					</div>
				</div>
			</div>
		</div>

		<script>
			const videoContainer = document.getElementById("video-container");
			const videoFeed = document.getElementById("video-feed");
			const infoContent = document.getElementById("info-content");

			videoContainer.addEventListener("click", async (e) => {
				// Get click coordinates relative to the image
				const rect = videoFeed.getBoundingClientRect();
				const x = Math.round(
					(e.clientX - rect.left) * (videoFeed.naturalWidth / rect.width)
				);
				const y = Math.round(
					(e.clientY - rect.top) * (videoFeed.naturalHeight / rect.height)
				);

				// Show click indicator
				const indicator = document.createElement("div");
				indicator.className = "click-indicator";
				indicator.style.left = e.clientX - rect.left + "px";
				indicator.style.top = e.clientY - rect.top + "px";
				videoContainer.appendChild(indicator);
				setTimeout(() => indicator.remove(), 1000);

				// Show loading state
				infoContent.innerHTML = `
                <div class="placeholder">
                    <div class="loading"></div>
                    <p style="margin-top: 20px;">Analyzing object with AI...</p>
                </div>
            `;

				// Send request to backend
				try {
					const response = await fetch("/get_object_info", {
						method: "POST",
						headers: {
							"Content-Type": "application/json",
						},
						body: JSON.stringify({ x, y }),
					});

					const data = await response.json();

					if (data.error) {
						infoContent.innerHTML = `
							<div class="placeholder">
								<p><strong>Error:</strong> ${data.error}</p>
							</div>
						`;
						return;
					}

					// Display object information
					const confidence = (data.confidence * 100).toFixed(1);
					infoContent.innerHTML = `
						<div class="object-info">
							<div class="info-card">
								<div class="info-label">Object Type</div>
								<div class="info-value">${data.class}</div>
							</div>
							
							<div class="info-card">
								<div class="info-label">Detection Confidence</div>
								<div class="info-value">${confidence}%</div>
								<div class="confidence-bar">
									<div class="confidence-fill" style="width: ${confidence}%"></div>
								</div>
							</div>
							
							<div class="info-card">
								<div class="info-label">AI Description</div>
								<div class="info-value">${data.description.replace(/\n/g, "<br>")}</div>
							</div>
						</div>
					`;
				} catch (error) {
					infoContent.innerHTML = `
						<div class="placeholder">
							<p><strong>Error:</strong> Failed to fetch object information - ${error.message}</p>
						</div>
					`;
				}
			});
		</script>
	</body>
</html>
